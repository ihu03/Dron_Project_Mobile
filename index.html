<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seoul ADS-B Live Map</title>
  <link rel="stylesheet" href="./leaflet.css" />
  <link rel="stylesheet" href="./styles.css" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0b1224" />
</head>
<body>
  <div class="app-shell">
    <header class="topbar">
      <div class="topbar-left">
        <div class="title">
          <span class="ping-dot" aria-hidden="true"></span>
          Seoul ADS-B Viewer
        </div>
        <div class="subtitle">Data: seoul.flightfeeder.page</div>
      </div>
      <div class="topbar-right">
        <div class="topbar-stats">
          <div id="stats" class="stats">Loading...</div>
          <div id="ping" class="stats">Ping: -- ms</div>
          <span id="push-status" class="pill pill-idle">알림 대기</span>
        </div>
        <div class="pwa-actions">
          <button id="push-enable" class="pwa-button" type="button" title="브라우저 알림 권한 요청">알림 허용</button>
          <button id="push-test" class="pwa-button ghost" type="button" title="저장된 구독으로 테스트 푸시 전송">테스트 알림</button>
          <button id="install-btn" class="pwa-button ghost hidden" type="button" title="홈 화면에 설치">앱 설치</button>
        </div>
      </div>
    </header>
    <main class="layout">
      <div class="map-wrap">
        <div id="map" class="map"></div>
        <div id="detail-panel" class="detail-panel" hidden>
          <div class="detail-header">
            <div class="detail-titles">
              <div id="detail-callsign" class="detail-callsign">-</div>
              <div id="detail-hex" class="detail-hex">-</div>
            </div>
            <button id="detail-close" aria-label="닫기" type="button">×</button>
          </div>
          <div class="detail-body">
            <div class="detail-row">
              <span>위치</span><span id="detail-pos">-</span>
            </div>
            <div class="detail-row">
              <span>고도 (km)</span><span id="detail-alt">-</span>
            </div>
            <div class="detail-row">
              <span>속도</span><span id="detail-speed">-</span>
            </div>
            <div class="detail-row">
              <span>방향</span><span id="detail-track">-</span>
            </div>
            <div class="detail-row">
              <span>식별</span><span id="detail-squawk">-</span>
            </div>
            <div class="detail-row">
              <span>등록국가</span><span id="detail-country">-</span>
            </div>
            <button id="detail-delete-fake" class="ghost-btn" type="button" hidden>기체 삭제</button>
            <div class="detail-image-wrap" hidden>
              <img id="detail-image" alt="기체 이미지" hidden />
              <div id="detail-image-text" class="detail-image-text" hidden>기체 이미지를 불러올 수 없음</div>
            </div>
            <div class="detail-note" id="detail-note">ADS-B Live</div>
          </div>
        </div>
        <div class="map-brightness-control" aria-label="지도 밝기 조절">
          <div class="brightness-label">
            <span>지도 밝기</span>
            <span id="map-brightness-value">70%</span>
          </div>
          <input id="map-brightness" type="number" min="10" max="100" step="1" value="70" inputmode="numeric" />
        </div>
      </div>
      <aside class="sidebar">
        <div class="sidebar-content">
          <div class="controls">
            <input id="search" type="text" placeholder="Filter by callsign or hex" />
            <button id="clearFilter" type="button">Clear</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Callsign</th>
                  <th>Lat</th>
                  <th>Lon</th>
                  <th>Alt (km)</th>
                </tr>
              </thead>
              <tbody id="table-body"></tbody>
            </table>
          </div>
          <div class="fake-panel">
            <div class="panel-title">상황 / 경고</div>
            <div class="input-row">
              <label for="radar-radius-input">
                레이더 반경 (km)
                <span class="value"><input id="radar-radius-value" type="number" min="10" max="400" step="1" value="120" inputmode="numeric" /></span>
              </label>
              <div class="single-range">
                <div class="range-rail"></div>
                <div class="range-fill" id="radar-range-fill"></div>
                <input id="radar-radius-input" type="range" min="10" max="400" step="1" value="120" />
              </div>
            </div>
            <div class="input-row">
              <label for="safety-radius-input">
                안전 반경 (km)
                <span class="value"><input id="safety-radius-value" type="number" min="1" max="100" step="1" value="5" inputmode="numeric" /></span>
              </label>
              <div class="single-range">
                <div class="range-rail"></div>
                <div class="range-fill" id="safety-range-fill"></div>
                <input id="safety-radius-input" type="range" min="1" max="100" step="1" value="5" />
              </div>
            </div>
            <div class="input-row">
              <label for="alt-range-input">
                고도 허용 범위 (km)
                <span class="value">
                  <input id="alt-range-value" type="number" min="0" max="6" step="0.1" value="6" inputmode="decimal" />
                </span>
              </label>
              <div class="single-range">
                <div class="range-rail"></div>
                <div class="range-fill" id="alt-range-fill"></div>
                <input id="alt-range-input" type="range" min="0" max="6" step="0.1" value="6" />
              </div>
            </div>
            <div class="input-row double">
              <label>
                ETA 범위(분)
                <span class="value">
                  <input id="eta-max-value" type="number" min="0" max="10" step="1" value="10" inputmode="numeric" />
                </span>
              </label>
              <div class="single-range">
                <div class="range-rail"></div>
                <div class="range-fill" id="eta-range-fill"></div>
                <input id="eta-max-input" type="range" min="0" max="10" step="1" value="10" />
              </div>
            </div>
            <div class="stat-row"><span>레이더 내 기체</span><span id="radar-count">0</span></div>
            <div class="stat-row"><span>최소 접근 ETA</span><span id="eta">-</span></div>
            <div class="warn" id="warn-msg">감시 중인 가상 기체가 없습니다.</div>
            <div class="list" id="approach-list"></div>
          </div>
        </div>
      </aside>
    </main>
    <div class="floating-form">
      <div class="form-header">
        <div class="panel-title">기체 추가</div>
        <button id="close-fake-form" class="close-btn" type="button" aria-label="닫기">×</button>
      </div>
      <div class="form-row">
        <label>Callsign</label>
        <input id="fake-callsign" type="text" placeholder="FAKE01" />
      </div>
      <div class="form-row">
        <label>Lat</label>
        <input id="fake-lat" type="number" step="0.0001" placeholder="37.5665" />
      </div>
      <div class="form-row">
        <label>Lon</label>
        <input id="fake-lon" type="number" step="0.0001" placeholder="126.9780" />
      </div>
      <div class="form-row">
        <label>Alt(m)</label>
        <input id="fake-alt" type="number" step="10" placeholder="3658" />
      </div>
      <button id="add-fake" type="button" class="add-btn">추가</button>
    </div>
    <button id="fake-form-trigger" class="floating-trigger" type="button">기체 추가</button>
  </div>

  <div id="mobile-install-sheet" class="mobile-install" aria-live="polite">
    <div class="mobile-install__panel">
      <div class="mobile-install__header">
        <div class="mobile-install__eyebrow">Seoul ADS-B Viewer</div>
      </div>
      <div class="mobile-install__body">
        <div class="mobile-install__intro">
          <div class="mobile-install__icon" aria-hidden="true">📡</div>
          <div>
            <div class="mobile-install__title">모바일에서 바로 보기</div>
            <div class="mobile-install__subtitle">홈 화면에 설치해두면 한 번 탭으로 실시간 항공정보를 열 수 있습니다.</div>
          </div>
        </div>
        <ul class="mobile-install__steps">
          <li>“다운로드/설치”를 눌러 앱처럼 추가</li>
          <li>혹은 브라우저 메뉴 → “홈 화면에 추가” 선택</li>
          <li>설치 후 아이콘을 누르면 `/mobile.html`에서 시작</li>
        </ul>
        <div class="mobile-install__actions">
          <button id="mobile-install-download" type="button" class="mobile-install__primary">다운로드/설치</button>
        </div>
        <div id="mobile-install-hint" class="mobile-install__hint" hidden></div>
      </div>
    </div>
  </div>

  <script src="./leaflet.js"></script>
  <script src="./script.js"></script>
</body>
</html>

